var Tx = require('ethereumjs-tx')
const Web3 = require('web3')
const web3 = new Web3('https://ropsten.infura.io/v3/42aaa48771054803a55bc1ad26f70a47')

const pubKey1 = '0x3C3A33Fd6264704c6B788071C316cED106FEAe03'
const privateKey1 = Buffer.from('ebd991e9dce3eb1610e94c866e6ce9aa2eba40eb4faff5483c26b466a301434e', 'hex')


web3.eth.getTransactionCount(pubKey1, (err, txCount) => {

	// Smart contract data (from Remix web3deploy data:)
	const data = '0x608060405234801561001057600080fd5b506111f4806100206000396000f300608060405260043610610083576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630686f530146100885780630cbe28d6146100b357806347015b19146100e05780636367e8721461010b5780637b0472f014610192578063ac3f58a8146101bc578063fbd962a7146102b5575b600080fd5b34801561009457600080fd5b5061009d6102e0565b6040518082815260200191505060405180910390f35b3480156100bf57600080fd5b506100de600480360381019080803590602001909291905050506102e6565b005b3480156100ec57600080fd5b506100f5610690565b6040518082815260200191505060405180910390f35b34801561011757600080fd5b5061017c600480360381019080803590602001908201803590602001908080601f016020809104026020016040519081016040528093929190818152602001838380828437820191505050505050919291929080359060200190929190505050610696565b6040518082815260200191505060405180910390f35b6101ba600480360381019080803590602001909291908035906020019092919050505061094d565b005b3480156101c857600080fd5b506101e760048036038101908080359060200190929190505050610c9d565b60405180878152602001806020018681526020018573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200184815260200183151515158152602001828103825287818151815260200191508051906020019080838360005b8381101561027557808201518184015260208101905061025a565b50505050905090810190601f1680156102a25780820380516001836020036101000a031916815260200191505b5097505050505050505060405180910390f35b3480156102c157600080fd5b506102ca610d9e565b6040518082815260200191505060405180910390f35b60025481565b6102ee6110b2565b60006102f8611101565b60008085815260200190815260200160002060c0604051908101604052908160008201548152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156103b95780601f1061038e576101008083540402835291602001916103b9565b820191906000526020600020905b81548152906001019060200180831161039c57829003601f168201915b50505050508152602001600282015481526020016003820160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001600482015481526020016005820160009054906101000a900460ff1615151515815250509250826040015142101515156104eb576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260268152602001807f5468657265206973207374696c6c207374616b696e672074696d652072656d6181526020017f696e696e672e000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b8260a0015115151561058b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260218152602001807f656e645374616b652068617320616c7265616479206265656e2063616c6c656481526020017f2e0000000000000000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b60018360a0019015159081151581525050600160008581526020019081526020016000206060604051908101604052908160008201548152602001600182015481526020016002820154815250509050806000015160046000828254019250508190555080604001518160200151101515610609576001915061060e565b600091505b7f5c9f2456dc000d29b80fd797687d0579505ed91b9ed9fc0696a97250ec6110a981600001516040518082815260200191505060405180910390a17fd2c4f99e0dcdd2d5d994682620ba03136c688092dde2fb87f337b2d50a099cdb826040518082815260200191505060405180910390a161068a8483610da4565b50505050565b60045481565b60008060008451111515610738576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252603b8152602001807f72657175697265732062797465732873746174656d656e7429203e20302e205081526020017f6f737369626c7920656d70747920737472696e6720676976656e2e000000000081525060400191505060405180910390fd5b82420190506002600081548092919060010191905055915060c0604051908101604052808381526020018581526020018281526020013373ffffffffffffffffffffffffffffffffffffffff16815260200160008152602001600015158152506000808481526020019081526020016000206000820151816000015560208201518160010190805190602001906107d0929190611123565b506040820151816002015560608201518160030160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506080820151816004015560a08201518160050160006101000a81548160ff02191690831515021790555090505060606040519081016040528060008152602001600081526020016000815250600160008481526020019081526020016000206000820151816000015560208201518160010155604082015181600201559050507fd9637787a7ad48762a887c18fd986b91dd193909887359b5d6ac4658c71146c384826040518080602001838152602001828103825284818151815260200191508051906020019080838360005b8381101561090b5780820151818401526020810190506108f0565b50505050905090810190601f1680156109385780820380516001836020036101000a031916815260200191505b50935050505060405180910390a15092915050565b600080341115156109c6576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260198152602001807f496e73756666696369656e74207374616b652076616c75652e0000000000000081525060200191505060405180910390fd5b60008214806109d55750600182145b1515610a49576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f496e76616c696420706f736974696f6e20746f207374616b65206f6e2e00000081525060200191505060405180910390fd5b60025483108015610a5b575060008310155b1515610acf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260158152602001807f496e76616c69642053746174656d656e742049442e000000000000000000000081525060200191505060405180910390fd5b600080848152602001908152602001600020905080600201544211151515610b85576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001807f5374616b6520616c726561647920656e64656420666f7220746869732073746181526020017f74656d656e742e0000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b6060604051908101604052803373ffffffffffffffffffffffffffffffffffffffff1681526020013481526020018381525081600601600083600401600081548092919060010191905055815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506020820151816001015560408201518160020155905050610c4734838561100d565b7fb298d3ab32c679086f18d987352596889499f5f20f410e2adb6a02f3b14abc048334604051808381526020018281526020019250505060405180910390a1600360008154809291906001019190505550505050565b6000602052806000526040600020600091509050806000015490806001018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610d4f5780601f10610d2457610100808354040283529160200191610d4f565b820191906000526020600020905b815481529060010190602001808311610d3257829003601f168201915b5050505050908060020154908060030160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060040154908060050160009054906101000a900460ff16905086565b60035481565b6000806000806000610db4611101565b60008060008a81526020019081526020016000209250600160008a815260200190815260200160002060606040519081016040529081600082015481526020016001820154815260200160028201548152505091507f57a7946d38e3cbe84bb4671f46152c0925c1916c23f9eaa59777522f76e3da1a898360000151604051808381526020018281526020019250505060405180910390a18160200151945081604001519350600090505b82600401548110156110025787836006016000838152602001908152602001600020600201541415610ff5576001881415610ec15784848460060160008481526020019081526020016000206001015402811515610eb957fe5b049650610eea565b83858460060160008481526020019081526020016000206001015402811515610ee657fe5b0496505b7ffc2ba9d3c128590669b6cb008f3e935cd5f1ebb1b3671baf68e4ce0c2eac623b876040518082815260200191505060405180910390a186836006016000838152602001908152602001600020600101540195507fd6aa017d64bb110be03cd473bcfc9121cb653df065fef9796ee597a8d6d7b877866040518082815260200191505060405180910390a182600601600082815260200190815260200160002060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc879081150290604051600060405180830381858888f19350505050158015610ff3573d6000803e3d6000fd5b505b8080600101915050610e5f565b505050505050505050565b6000600160008381526020019081526020016000209050838160000160008282540192505081905550600183141561105657838160010160008282540192505081905550611069565b8381600201600082825401925050819055505b7f57a7946d38e3cbe84bb4671f46152c0925c1916c23f9eaa59777522f76e3da1a828260000154604051808381526020018281526020019250505060405180910390a150505050565b60c060405190810160405280600081526020016060815260200160008152602001600073ffffffffffffffffffffffffffffffffffffffff168152602001600081526020016000151581525090565b6060604051908101604052806000815260200160008152602001600081525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061116457805160ff1916838001178555611192565b82800160010185558215611192579182015b82811115611191578251825591602001919060010190611176565b5b50905061119f91906111a3565b5090565b6111c591905b808211156111c15760008160009055506001016111a9565b5090565b905600a165627a7a7230582094b2a3aead526d273c13d662adea97e19343331fd0e58e93992e7722c4de3af50029'


	// Create tx object
	const txObject = {
		nonce: web3.utils.toHex(txCount),
		gasLimit: web3.utils.toHex(1000000),
		gasPrice: web3.utils.toHex(web3.utils.toWei('100', 'gwei')),
		data: data
	}

	// sign the tx
	const tx = new Tx(txObject)
	tx.sign(privateKey1)

	const serializedTx = tx.serialize()
	const raw = '0x' + serializedTx.toString('hex')

	// Broadcast the tx
	web3.eth.sendSignedTransaction(raw, (err, txHash) => {
		console.log('err: ', err, 'txHash: ', txHash)
	})

})